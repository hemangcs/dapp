<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <meta http-equiv="X-UA-Compatible" content="ie=edge">
 <title>Document</title>
<link rel="stylesheet" type="text/css" href="index.css">
<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@0.18.2/dist/web3.min.js"></script>
</head>
<body>
 <div class="container">
<h1>Digital Pathology Enabler</h1>
<h2 id="MedRecord"></h2>
<img id="loader" src="Spinner.gif">
<label for="id" class="col-lg-2 control-label">Id </label>
 <input id="id" type="text">
<label for="fname" class="col-lg-2 control-label">URL </label>
 <input id="fname" type="text" value = "Context ID">
 <button id="button">Update Medical Record</button>
</div>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script>
   web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
   web3.eth.defaultAccount = web3.eth.accounts[0];
   console.log(web3.eth.defaultAccount);
   console.log(web3.eth.getBlock("latest").gasLimit);
//   console.log(web3.eth.getBalance("0xaf6dace9cfef128737b907e1de08567256860aa8"));

var MedContract = web3.eth.contract([{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"_to","type":"address"},{"indexed":true,"internalType":"uint256","name":"_tokenId","type":"uint256"},{"indexed":false,"internalType":"bytes32","name":"_ipfsHash","type":"bytes32"}],"name":"Mint","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"_to","type":"address"},{"indexed":true,"internalType":"uint256","name":"_tokenId","type":"uint256"},{"indexed":true,"internalType":"string","name":"uri","type":"string"}],"name":"MintUri","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"_from","type":"address"},{"indexed":false,"internalType":"address","name":"_to","type":"address"},{"indexed":false,"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"SAFETransferFrom","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"_from","type":"address"},{"indexed":true,"internalType":"address","name":"_to","type":"address"},{"indexed":true,"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[{"internalType":"address","name":"_to","type":"address"},{"internalType":"bytes32","name":"_ipfsHash","type":"bytes32"}],"name":"mint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_to","type":"address"},{"internalType":"string","name":"_uri","type":"string"}],"name":"mint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_from","type":"address"},{"internalType":"address","name":"_to","type":"address"},{"internalType":"uint256","name":"_tokenId","type":"uint256"},{"internalType":"bytes32","name":"_hash","type":"bytes32"}],"name":"safeTransferFrom","outputs":[{"internalType":"bytes32","name":"hash","type":"bytes32"}],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"_to","type":"address"},{"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"transfer","outputs":[],"stateMutability":"nonpayable","type":"function"}],
{from:'0x9c0f4c74c828e5F6D424cBB5B9C68eAc20642314', gasPrice:'20000000000',gasLimit:'90000000'});


var MediCo = MedContract.at('0x9c0f4c74c828e5F6D424cBB5B9C68eAc20642314');
$("#button").click(function() {
    MediCo.mint(web3.eth.defaultAccount,$("#id").val());
    var MedicoEvent = MediCo.Mint();
    MedicoEvent.watch(function(error, result){
        console.log("in here");
            if (!error)
                {
                    $("#loader").hide();
                    $("#MedRecord").html('here' + result.args._to+ '(' + result.args._tokenId + 'tokenID)');
                    console.log(result.args);
                } else {
                    $("#loader").hide();
                    console.log(error);
                }
        });
console.log(" out here");
var transfers = MediCo.Transfer( {}, {fromBlock: 0, toBlock: 'latest'})
transfers.watch(function(error, result) {
  console.log("error none");
  console.log(result);
});
});
 </script>
</body>
</html>